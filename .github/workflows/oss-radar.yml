# ===== OSS RADAR WORKFLOW =====
# Weekly scan of GitHub for relevant open-source projects.
#
# Output:
# - Updates docs/OSS_RADAR.md (auto-generated)
# - Opens a PR only if the file changed

name: OSS Radar

on:
  schedule:
    - cron: "0 9 * * 1" # Mondays 09:00 UTC
  workflow_dispatch: {}

permissions:
  contents: write
  pull-requests: write

jobs:
  scan:
    name: Refresh OSS Radar
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Bun
        uses: oven-sh/setup-bun@v2
        with:
          bun-version: latest

      - name: Install dependencies
        run: bun install --frozen-lockfile

      - name: Run OSS scan
        run: bun run oss:scan
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Create PR with updated radar
        uses: peter-evans/create-pull-request@v7
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: "chore: refresh OSS radar"
          title: "chore: refresh OSS radar"
          body: |
            Auto-generated by the scheduled OSS Radar workflow.

            If these results are noisy, tune queries in `oss-scan.config.json`.
          branch: "bot/oss-radar"
          delete-branch: true
          add-paths: |
            docs/OSS_RADAR.md
